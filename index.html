<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Liturgia das Horas Maronita</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400..700;1,400..700&family=Inter:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #582c0c; --text-color: #333333; --background-color: #fdfaf6;
            --border-color: #e0d8cf; --button-bg-color: #f1ede9; --font-serif: 'Lora', serif; --font-sans: 'Inter', sans-serif;
        }
        body { font-family: var(--font-serif); background-color: var(--background-color); color: var(--text-color); margin: 0; padding: 1rem; display: flex; flex-direction: column; align-items: center; min-height: 100vh; }
        .container { width: 100%; max-width: 800px; background-color: #ffffff; border: 1px solid var(--border-color); border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); padding: 1.5rem 2rem; }
        header { text-align: center; border-bottom: 2px solid var(--border-color); padding-bottom: 1rem; margin-bottom: 1rem; }
        header h1 { font-family: var(--font-sans); color: var(--primary-color); margin: 0; font-size: 1.8rem; }
        
        #permanent-nav { display: flex; justify-content: center; gap: 0.5rem; margin-bottom: 1rem; flex-wrap: wrap; }
        #permanent-nav button { background-color: var(--button-bg-color); border: 1px solid var(--border-color); color: var(--primary-color); padding: 0.6rem 1rem; border-radius: 8px; cursor: pointer; font-family: var(--font-sans); font-size: 0.9rem; transition: background-color 0.2s; }
        #permanent-nav button:hover { background-color: #e9e4e0; }

        #date-navigator { display: flex; justify-content: space-between; align-items: center; padding: 1rem 0; font-family: var(--font-sans); border-top: 1px solid var(--border-color); margin-top: 1rem;}
        #date-navigator button { background: none; border: 1px solid var(--border-color); color: var(--primary-color); padding: 0.5rem 1rem; border-radius: 20px; cursor: pointer; font-size: 0.9rem; transition: background-color 0.2s; }
        #date-navigator button:hover { background-color: var(--button-bg-color); }
        #current-date-display { font-size: 1.2rem; font-weight: bold; color: var(--primary-color); text-align: center; }
        
        main { line-height: 1.8; }
        .prayer-button { display: block; padding: 1rem; margin-bottom: 0.5rem; text-align: center; background-color: #f1ede9; color: #582c0c; text-decoration: none; border-radius: 8px; font-family: 'Inter', sans-serif; transition: background-color 0.2s; }
        .prayer-button:hover { background-color: #e9e4e0; }

        footer { margin-top: 2rem; text-align: center; font-family: var(--font-sans); font-size: 0.8rem; color: #999; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Liturgia das Horas - Rito Maronita</h1>
        </header>

        <nav id="permanent-nav">
            <button id="btn-daily">Liturgia do Dia</button>
            <button id="btn-ordinario">Ordinário</button>
            <button id="btn-comum">Comum dos Santos</button>
        </nav>

        <main id="liturgy-content">
            </main>
        
        <nav id="date-navigator">
            <button id="btn-prev-day">&lt; Dia Anterior</button>
            <div id="current-date-display">Carregando...</div>
            <button id="btn-next-day">Próximo Dia &gt;</button>
        </nav>

    </div>

    <footer>
        <p>Projeto Mosteiro Digital v4.0</p>
    </footer>

    <script>
        // --- FONTES DE DADOS ---
        const dailyLiturgyUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSaYltImPmgdtHoJbz3ce82BdepGLIYM0J3jXGednNbTxtHkn7BhouHUnaKXgtDT1gvBUvY9iJSjDid/pub?gid=0&single=true&output=csv';
        const comumUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSaYltImPmgdtHoJbz3ce82BdepGLIYM0J3jXGednNbTxtHkn7BhouHUnaKXgtDT1gvBUvY9iJSjDid/pub?gid=893557401&single=true&output=csv';

        // --- ELEMENTOS DO DOM ---
        const mainContent = document.getElementById('liturgy-content');
        const dateDisplay = document.getElementById('current-date-display');
        const dateNavigator = document.getElementById('date-navigator');
        
        // --- BOTÕES ---
        const btnPrev = document.getElementById('btn-prev-day');
        const btnNext = document.getElementById('btn-next-day');
        const btnDaily = document.getElementById('btn-daily');
        const btnOrdinario = document.getElementById('btn-ordinario');
        const btnComum = document.getElementById('btn-comum');

        let currentDate = new Date();
        let comumDataCache = null; // Cache para os dados do Comum

        // --- FUNÇÕES DE FORMATAÇÃO E EXIBIÇÃO ---
        function formatarDataParaBusca(date) {
            const ano = date.getFullYear();
            const mes = String(date.getMonth() + 1).padStart(2, '0');
            const dia = String(date.getDate()).padStart(2, '0');
            return `${ano}/${mes}/${dia}`;
        }

        function formatarDataParaExibicao(date) {
            return date.toLocaleDateString('pt-BR', { day: '2-digit', month: '2-digit', year: 'numeric' });
        }
        
        function exibirMensagem(mensagem) {
            mainContent.innerHTML = `<div style="font-family: 'Inter', sans-serif; text-align: center; padding: 2rem;">${mensagem}</div>`;
        }
        
        function renderizarBotoes(listaDeBotoes) {
             let botoesHtml = '';
             listaDeBotoes.forEach(item => {
                 botoesHtml += `<a href="${item.link}" target="_blank" class="prayer-button">${item.nome}</a>`;
             });
             mainContent.innerHTML = botoesHtml;
        }

        // --- LÓGICA PRINCIPAL ---

        // 1. LITURGIA DO DIA (CALENDÁRIO)
        async function buscarOracoesDoDia(date) {
            dateNavigator.style.display = 'flex';
            const dataFormatadaBusca = formatarDataParaBusca(date);
            dateDisplay.textContent = formatarDataParaExibicao(date);
            exibirMensagem('Buscando orações do dia...');

            try {
                const response = await fetch(dailyLiturgyUrl);
                if (!response.ok) throw new Error(`Falha na rede`);
                
                const data = await response.text();
                const oracoes = [];
                const linhas = data.split('\n');

                for (let i = 1; i < linhas.length; i++) {
                    const linha = linhas[i].trim();
                    if (linha) {
                        const colunas = linha.split(',');
                        if (colunas.length >= 5 && colunas[0].trim() === dataFormatadaBusca) {
                            oracoes.push({ nome: colunas[3].trim(), link: colunas[4].trim() });
                        }
                    }
                }

                if (oracoes.length > 0) {
                    renderizarBotoes(oracoes);
                } else {
                    exibirMensagem(`Nenhuma Oração Encontrada para o dia ${formatarDataParaExibicao(date)}`);
                }
            } catch (error) {
                exibirMensagem(`<strong>Erro:</strong> ${error.message}`);
            }
        }

        // 2. ORDINÁRIO
        async function buscarOrdinario() {
            dateNavigator.style.display = 'none';
            exibirMensagem('Buscando Ordinário...');

            try {
                const response = await fetch(dailyLiturgyUrl);
                if (!response.ok) throw new Error(`Falha na rede`);

                const data = await response.text();
                const ordinarioItens = [];
                const linhas = data.split('\n');

                for (let i = 1; i < linhas.length; i++) {
                    const linha = linhas[i].trim();
                    if (linha) {
                        const colunas = linha.split(',');
                        if (colunas.length >= 5 && colunas[0].trim().toUpperCase() === 'ORDINARIO') {
                             ordinarioItens.push({ nome: colunas[3].trim(), link: colunas[4].trim() });
                        }
                    }
                }

                if (ordinarioItens.length > 0) {
                    renderizarBotoes(ordinarioItens);
                } else {
                    exibirMensagem('Nenhum item do Ordinário encontrado. Verifique a planilha.');
                }
            } catch (error) {
                exibirMensagem(`<strong>Erro:</strong> ${error.message}`);
            }
        }

        // 3. COMUM DOS SANTOS
        async function exibirMenuComum() {
            dateNavigator.style.display = 'none';
            exibirMensagem('Carregando categorias...');

            try {
                 if (!comumDataCache) {
                    const response = await fetch(comumUrl);
                    if (!response.ok) throw new Error(`Falha na rede`);
                    comumDataCache = await response.text();
                }

                const categorias = new Set();
                const linhas = comumDataCache.split('\n');
                
                for (let i = 1; i < linhas.length; i++) {
                    const linha = linhas[i].trim();
                    if (linha) {
                        const colunas = linha.split(',');
                        if (colunas.length > 0 && colunas[0].trim()) {
                            categorias.add(colunas[0].trim());
                        }
                    }
                }

                if (categorias.size > 0) {
                    let botoesHtml = '';
                    categorias.forEach(cat => {
                        // Usamos aspas simples e escapamos as aspas dentro do onclick
                        botoesHtml += `<a href="#" onclick="event.preventDefault(); buscarComumPorCategoria('${cat.replace(/'/g, "\\'")}')" class="prayer-button">${cat}</a>`;
                    });
                    mainContent.innerHTML = botoesHtml;
                } else {
                    exibirMensagem('Nenhuma categoria do Comum encontrada.');
                }
            } catch (error) {
                 exibirMensagem(`<strong>Erro:</strong> ${error.message}`);
            }
        }

        function buscarComumPorCategoria(categoria) {
            exibirMensagem(`Buscando orações para ${categoria}...`);
            const oracoes = [];
            const linhas = comumDataCache.split('\n');

            for (let i = 1; i < linhas.length; i++) {
                const linha = linhas[i].trim();
                if (linha) {
                    const colunas = linha.split(',');
                    if (colunas.length >= 3 && colunas[0].trim() === categoria) {
                        oracoes.push({ nome: colunas[1].trim(), link: colunas[2].trim() });
                    }
                }
            }
            
            if (oracoes.length > 0) {
                renderizarBotoes(oracoes);
            } else {
                exibirMensagem(`Nenhuma oração encontrada para ${categoria}.`);
            }
        }


        // --- EVENT LISTENERS ---
        btnPrev.addEventListener('click', () => {
            currentDate.setDate(currentDate.getDate() - 1);
            buscarOracoesDoDia(currentDate);
        });

        btnNext.addEventListener('click', () => {
            currentDate.setDate(currentDate.getDate() + 1);
            buscarOracoesDoDia(currentDate);
        });
        
        btnDaily.addEventListener('click', () => buscarOracoesDoDia(currentDate));
        btnOrdinario.addEventListener('click', buscarOrdinario);
        btnComum.addEventListener('click', exibirMenuComum);

        // --- INICIALIZAÇÃO ---
        buscarOracoesDoDia(currentDate);

    </script>
</body>
</html>












