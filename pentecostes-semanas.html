<!-- pentecostes-semanas.html — atualizado para CSV (ignora “ativo”) -->
<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>Pentecostes — Semanas do Tempo · Salmos e Leituras</title>
<meta name="theme-color" content="#7a0b0b">
<style>
:root{--bordo:#7a0b0b;--dourado:#d6b25a;--texto:#6d0000;--prata:#b0b0b0;--branco:#ffffff;--shadow:rgba(0,0,0,.16);--fonte:Arial, Helvetica, sans-serif;--btnIcon:29.6px}
*{box-sizing:border-box;margin:0;padding:0} html,body{height:100%}
body{font-family:var(--fonte);background:linear-gradient(to top, var(--bordo) 0%, #a33 45%, #c95 78%, var(--dourado) 100%);min-height:100vh;display:flex;flex-direction:column;overflow-x:hidden;position:relative}
header{text-align:center;padding:24px 10px 8px}
.title{color:var(--texto);font-weight:900;font-size:1.9rem;text-shadow:-1px -1px 0 var(--prata),1px -1px 0 var(--prata),-1px 1px 0 var(--prata),1px 1px 0 var(--prata)}
.wrap{max-width:640px;margin:0 auto;padding:12px 16px 22px;width:100%}
.hero{display:block;margin:10px auto 16px;height:360px;width:auto;aspect-ratio:3/4;object-fit:cover;max-height:560px;border:4px solid var(--prata);box-shadow:inset 0 0 0 4px var(--branco),0 8px 16px var(--shadow);border-radius:14px}
/* Botão central */
.btn{display:grid;grid-template-columns:var(--btnIcon) 1fr var(--btnIcon);align-items:center;text-align:center;background:#fff;color:var(--texto);text-decoration:none;font-weight:900;border:3px solid var(--prata);box-shadow:inset 0 0 0 3px var(--branco),0 4px 10px var(--shadow);border-radius:18px;padding:6px 18px;width:94%;margin:0 auto 10px;transition:transform .12s,filter .2s}
.btn:hover{transform:scale(1.02);filter:brightness(1.04)}
.btn .icon{width:var(--btnIcon);height:var(--btnIcon);border-radius:50%;border:2px solid var(--prata);box-shadow:inset 0 0 0 2px var(--branco);object-fit:cover}
.btn .label{text-align:center;color:var(--texto);text-shadow:-1px -1px 0 var(--prata),1px -1px 0 var(--prata),-1px 1px 0 var(--prata),1px 1px 0 var(--prata)}
.btn .slot{width:var(--btnIcon);height:var(--btnIcon)}
/* Navegação */
.navrow{display:flex;justify-content:space-between;gap:16px;max-width:94%;margin:0 auto}
.navbtn{display:inline-flex;align-items:center;justify-content:center;min-width:46px;height:46px;padding:0 14px;gap:8px;background:#fff;color:var(--texto);border:3px solid var(--prata);border-radius:999px;box-shadow:inset 0 0 0 3px var(--branco),0 4px 10px var(--shadow);font-weight:900;cursor:pointer;transition:transform .12s,filter .2s}
.navbtn:hover{transform:scale(1.03);filter:brightness(1.04)}
.navbtn .arr{font-size:20px;line-height:1}
/* Voltar */
.back-wrap{display:flex;justify-content:center;margin-top:10px;transform:scale(.48);transform-origin:center top}
.btn-back{display:inline-flex;align-items:center;gap:10px;background:#a00000;color:#fff;border:none;border-radius:999px;padding:10px 16px;font-weight:800;box-shadow:0 6px 14px var(--shadow);cursor:pointer}
.btn-back .arr{font-size:18px;line-height:1}
</style>
<script>
function goBackOrMother(){
  try{
    if (document.referrer && document.referrer.includes('pentecoste.html')) { history.back(); return; }
    if (history.length>1) { history.back(); return; }
  }catch(e){}
  location.href='pentecoste.html';
}
</script>
</head>
<body>
<header><h1 class="title">Pentecostes — Semanas do Tempo · Salmos e Leituras</h1></header>

<main class="wrap">
  <img class="hero" src="img/icone-pentecostes.jpg" alt="Ícone — Pentecostes" onerror="this.style.display='none'">

  <a id="btn-week" class="btn" href="#" target="_blank" rel="noopener">
    <img class="icon" src="img/icone-pentecostes.jpg" alt="">
    <span class="label" id="week-label">Carregando…</span>
    <span class="slot"></span>
  </a>

  <div class="navrow">
    <button class="navbtn" id="prev"><span class="arr">←</span><span>Anterior</span></button>
    <button class="navbtn" id="next"><span>Próxima</span><span class="arr">→</span></button>
  </div>

  <div class="back-wrap"><button class="btn-back" onclick="goBackOrMother()"><span class="arr">←</span><span>Voltar</span></button></div>
</main>

<script>
/* CSV publicado (aba: salmos-leituras-pentecostes) */
const CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTSNOwDCcQPyPihUkD8PbrtAmMjV9gcYgCmOXNnAfK6chO41qAAtltEpzl-mlxEvlnMwGQQ-JgKjMI3/pub?gid=1455195695&single=true&output=csv';

/* Ordem e fallback dos rótulos (17 semanas) */
const ORDER = Array.from({length:17},(_,i)=>'w'+i);
const FALL  = [
  'Semana de Pentecostes','2ª Semana de Pentecostes','3ª Semana de Pentecostes',
  '4ª Semana de Pentecostes','5ª Semana de Pentecostes','6ª Semana de Pentecostes',
  '7ª Semana de Pentecostes','8ª Semana de Pentecostes','9ª Semana de Pentecostes',
  '10ª Semana de Pentecostes','11ª Semana de Pentecostes','12ª Semana de Pentecostes',
  '13ª Semana de Pentecostes','14ª Semana de Pentecostes','15ª Semana de Pentecostes',
  '16ª Semana de Pentecostes','17ª Semana de Pentecostes'
];

/* CSV helper */
function parseCSV(t){
  const rows=[]; let cell='', row=[], q=false;
  for(let i=0;i<t.length;i++){
    const c=t[i], n=t[i+1];
    if(q){ if(c==='"'&&n==='"'){cell+='"';i++;} else if(c==='"'){q=false;} else cell+=c; }
    else{
      if(c===','){ row.push(cell); cell=''; }
      else if(c==='\n'){ row.push(cell); rows.push(row); row=[]; cell=''; }
      else if(c==='"'){ q=true; }
      else if(c!=='\r'){ cell+=c; }
    }
  }
  if(cell.length||row.length){ row.push(cell); rows.push(row); }
  return rows;
}
function looksLikeURL(s){ return /^https?:\/\//i.test((s||'').trim()); }

/* Estado */
let items = ORDER.map((k,i)=>({key:k,label:FALL[i]||k,url:null})), idx=0;
const labelEl = document.getElementById('week-label');
const btnEl   = document.getElementById('btn-week');

function render(){
  const it = items[idx];
  labelEl.textContent = it.label || '—';
  if(it.url){
    btnEl.href = it.url;
    btnEl.style.opacity = 1;
    btnEl.style.pointerEvents = 'auto';
    btnEl.title = 'Abrir Salmos e Leituras';
  }else{
    btnEl.href = '#';
    btnEl.style.opacity = .55;
    btnEl.style.pointerEvents = 'none';
    btnEl.title = 'Link não configurado';
  }
}

/* Navegação */
document.getElementById('prev').addEventListener('click',()=>{ idx=(idx-1+items.length)%items.length; render(); });
document.getElementById('next').addEventListener('click',()=>{ idx=(idx+1)%items.length; render(); });

/* Carrega CSV e aplica (ignora “ativo”) */
fetch(CSV_URL).then(r=>r.text()).then(txt=>{
  const rows = parseCSV(txt).filter(r=>r.length>0);
  if(rows.length===0){ render(); return; }

  const head = rows[0].map(h=>h.trim().toLowerCase());
  let idxKey  = head.findIndex(h=>h==='key');
  let idxRot  = head.findIndex(h=>h==='rótulo' || h==='rotulo');
  let idxLink = head.findIndex(h=>h==='link_doc' || h==='link' || h==='url');

  const dataRows = (idxKey>-1 || idxRot>-1 || idxLink>-1) ? rows.slice(1) : rows;

  const map = new Map();
  dataRows.forEach(r=>{
    let key  = idxKey>-1  ? (r[idxKey]  ||'').trim() : (r[0]||'').trim();
    if(!key) return;
    let rot  = idxRot>-1  ? (r[idxRot]  ||'').trim() : (r[1]||'').trim();
    let link = idxLink>-1 ? (r[idxLink] ||'').trim() : (r[2]||'').trim();
    if(!link && looksLikeURL(rot)){ link = rot; }
    map.set(key,{ label: rot && !looksLikeURL(rot) ? rot : null, url: looksLikeURL(link) ? link : null });
  });

  items = ORDER.map((k,i)=>{
    const rec = map.get(k) || {};
    return { key:k, label: rec.label || FALL[i] || k, url: rec.url || null };
  });
}).catch(console.error).finally(render);
</script>
</body>
</html>

