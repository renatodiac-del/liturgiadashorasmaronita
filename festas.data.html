<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>Festas por Data</title>
<meta name="theme-color" content="#d9c7b0">
<style>
:root{
  --marromClaro:#e7d9c6; --ouroVelho:#b4923a; --texto:#3b2a19;
  --shadow:rgba(0,0,0,.15); --fonte: Arial, Helvetica, sans-serif;
  --vermelho:#a00000;
}
*{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%}
body{
  font-family:var(--fonte); background:var(--marromClaro); color:var(--texto);
  background-image:
    repeating-linear-gradient(45deg, rgba(180,146,58,.18) 0, rgba(180,146,58,.18) 2px, transparent 2px, transparent 42px),
    repeating-linear-gradient(-45deg, rgba(180,146,58,.10) 0, rgba(180,146,58,.10) 2px, transparent 2px, transparent 42px);
  background-size:42px 42px; display:flex; flex-direction:column; min-height:100vh;
}
header{text-align:center;padding:12px 12px 6px}
.title{
  color:#7a5522; font-weight:900; font-size:1.9rem; margin:0;
  text-shadow:
    -1px -1px 0 var(--ouroVelho),
     1px -1px 0 var(--ouroVelho),
    -1px  1px 0 var(--ouroVelho),
     1px  1px 0 var(--ouroVelho);
}
.wrap{max-width:640px;margin:0 auto;padding:10px 16px 24px;width:100%}
.hero{
  display:block;margin:8px auto 16px;max-width:100%;height:auto;max-height:420px;
  border:6px solid var(--ouroVelho);
  box-shadow:0 0 0 5px rgba(255,255,255,.0) inset, 0 6px 14px var(--shadow);
  border-radius:14px
}

/* Painel de data + navegação */
.navwrap{ text-align:center }
.panel{
  display:inline-flex; align-items:center; justify-content:center; text-align:center;
  padding:12px 20px; border-radius:14px; background:#fff; color:var(--texto);
  border:3px solid var(--ouroVelho); box-shadow: inset 0 0 0 3px rgba(180,146,58,.6), 0 2px 6px var(--shadow);
  font-weight:900; font-size:1.2rem; min-width:260px; user-select:none;
}
.navrow{display:flex; justify-content:center; gap:12px; margin-top:12px}
.navbtn{
  background:#fff; color:var(--texto); border-radius:12px; padding:9px 14px; font-weight:900;
  border:3px solid var(--ouroVelho); box-shadow: inset 0 0 0 3px rgba(180,146,58,.55), 0 2px 6px var(--shadow);
  cursor:pointer; transition:background-color .2s, transform .12s;
}
.navbtn:hover{background:#fffdf1; transform:translateY(-1px)}

/* Legenda da festividade */
.festlabel{
  margin:8px auto 0; padding:6px 10px; display:inline-block;
  background:#fff; border:2px solid var(--ouroVelho); border-radius:12px;
  box-shadow: inset 0 0 0 2px rgba(180,146,58,.5), 0 2px 6px var(--shadow);
  font-weight:900; color:#6b4a27; max-width:560px;
}

/* Botões padrão (4 grandes) */
.buttons{display:flex;flex-direction:column;gap:10px;align-items:center;margin:14px auto 4px}
.btn{
  position:relative;display:flex;align-items:center;justify-content:center;text-align:center;text-decoration:none;
  background:#fff;color:#5a3b1c;font-weight:900;border:3px solid var(--ouroVelho);border-radius:16px;
  padding:10px 18px;width:86%;box-shadow:inset 0 0 0 3px rgba(180,146,58,.6),0 4px 10px var(--shadow);
  transition:transform .15s ease, background-color .2s ease;
}
.btn:hover{transform:scale(1.02);background:#fffdf4}
.btn[aria-disabled="true"]{opacity:.55;pointer-events:none}
.btn img{
  position:absolute;left:12px;width:24px;height:24px;border-radius:50%;object-fit:cover;border:2px solid var(--ouroVelho)
}
.label{width:100%}
.line1{display:block;color:#b17f1f;font-size:1.02rem;line-height:1.06}
.line2{display:block;color:#222;font-size:.84rem;line-height:1.02}

/* Voltar */
.backrow{ text-align:center; margin-top:10px; }
.back{
  display:inline-flex; align-items:center; gap:8px; background:var(--vermelho); color:#fff;
  border:1px solid #6f0000; padding:.36rem .62rem; border-radius:9px;
  font-weight:bold; font-size:.9rem; text-decoration:none;
  transform:scale(.6); transform-origin:center;
}
.back:hover{ background:#c00000 }
</style>
</head>
<body>
<header><h1 class="title">Festas por Data</h1></header>

<main class="wrap">
  <img class="hero" src="img/icone-festadata.jpg" alt="Ícone — Festas por Data">

  <section aria-label="Navegação por datas especiais" class="navwrap">
    <div id="dataBtn" class="panel">--/--</div>
    <div id="festLabel" class="festlabel">Carregando…</div>

    <div class="navrow">
      <button id="prev" class="navbtn" type="button">← Anterior</button>
      <button id="next" class="navbtn" type="button">Próximo →</button>
    </div>
  </section>

  <!-- 4 botões padrão -->
  <section class="buttons" aria-label="Ritos do dia selecionado">
    <a class="btn" data-key="ramsho_curta" href="#" target="_blank" rel="noopener">
      <img src="img/cruz.png" alt=""><span class="label"><span class="line1">Ramsho</span><span class="line2">versão curta</span></span>
    </a>
    <a class="btn" data-key="ramsho_longa" href="#" target="_blank" rel="noopener">
      <img src="img/cruz.png" alt=""><span class="label"><span class="line1">Ramsho</span><span class="line2">versão longa</span></span>
    </a>
    <a class="btn" data-key="safro_curta" href="#" target="_blank" rel="noopener">
      <img src="img/cruz.png" alt=""><span class="label"><span class="line1">Safro</span><span class="line2">versão curta</span></span>
    </a>
    <a class="btn" data-key="safro_longa" href="#" target="_blank" rel="noopener">
      <img src="img/cruz.png" alt=""><span class="label"><span class="line1">Safro</span><span class="line2">versão longa</span></span>
    </a>
  </section>

  <!-- Botão Voltar -->
  <div class="backrow">
    <a class="back" href="javascript:history.back()"
       onclick="if(!document.referrer || (!document.referrer.includes('oracao.html') && !document.referrer.includes('index-teste.html'))){this.href='oracao.html'}">
      ← Voltar
    </a>
  </div>
</main>

<script>
const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTSNOwDCcQPyPihUkD8PbrtAmMjV9gcYgCmOXNnAfK6chO41qAAtltEpzl-mlxEvlnMwGQQ-JgKjMI3/pub?gid=1876996445&single=true&output=csv";

/* --- CSV parser simples com suporte a aspas --- */
function parseCSV(text){
  const rows=[]; let cur=[]; let val=""; let q=false;
  for(let i=0;i<text.length;i++){
    const c=text[i], n=text[i+1];
    if(q){
      if(c==='"' && n==='"'){ val+='"'; i++; }
      else if(c==='"'){ q=false; }
      else { val+=c; }
    }else{
      if(c==='"'){ q=true; }
      else if(c===','){ cur.push(val.trim()); val=""; }
      else if(c==='\n'){ cur.push(val.trim()); rows.push(cur); cur=[]; val=""; }
      else if(c==='\r'){ /* skip */ }
      else { val+=c; }
    }
  }
  if(val.length || cur.length) { cur.push(val.trim()); rows.push(cur); }
  return rows;
}

const dataBtn   = document.getElementById('dataBtn');
const festLabel = document.getElementById('festLabel');
const prevBt    = document.getElementById('prev');
const nextBt    = document.getElementById('next');

let ENTRIES = [];   // {chave:"DD/MM", titulo:"...", ramsho_curta:URL, ...}
let idx = 0;

function setBtnLink(a, url){
  if(url){
    a.href = url;
    a.setAttribute('aria-disabled','false');
  }else{
    a.href = '#';
    a.setAttribute('aria-disabled','true');
  }
}

function render(){
  if(!ENTRIES.length){
    dataBtn.textContent='--/--';
    festLabel.textContent='Nenhum dado';
    document.querySelectorAll('[data-key]').forEach(a=>setBtnLink(a,null));
    prevBt.disabled = nextBt.disabled = true;
    return;
  }
  const e = ENTRIES[idx];
  dataBtn.textContent = e.chave || '--/--';
  festLabel.textContent = e.titulo || '—';
  document.querySelectorAll('[data-key]').forEach(a=>{
    const k=a.getAttribute('data-key');
    setBtnLink(a, e[k] || null);
  });
}

prevBt.onclick=()=>{ if(!ENTRIES.length) return; idx=(idx-1+ENTRIES.length)%ENTRIES.length; render(); }
nextBt.onclick=()=>{ if(!ENTRIES.length) return; idx=(idx+1)%ENTRIES.length; render(); }

/* --- Carrega CSV e monta ENTRIES --- */
(async function init(){
  try{
    const res = await fetch(CSV_URL, {cache:'no-store'});
    const txt = await res.text();
    const rows = parseCSV(txt).filter(r=>r.length && r.some(x=>x&&x.trim().length));
    if(!rows.length){ throw new Error('CSV vazio'); }

    // cabeçalho esperado: chave,titulo,ramsho_curta,ramsho_longa,safro_curta,safro_longa
    const header = rows[0].map(h=>h.toLowerCase());
    const idxOf = name => header.indexOf(name);
    const iCh = idxOf('chave'), iTi = idxOf('titulo'),
          iRc = idxOf('ramsho_curta'), iRl = idxOf('ramsho_longa'),
          iSc = idxOf('safro_curta'),  iSl = idxOf('safro_longa');

    ENTRIES = rows.slice(1).map(r=>({
      chave: (r[iCh]||'').padStart(5,'0'),   // garante "DD/MM"
      titulo: r[iTi]||'',
      ramsho_curta: r[iRc]||'',
      ramsho_longa: r[iRl]||'',
      safro_curta : r[iSc]||'',
      safro_longa : r[iSl]||'',
    }))
    // filtra linhas totalmente vazias (sem nenhum link e sem título/chave)
    .filter(e => e.chave || e.titulo || e.ramsho_curta || e.ramsho_longa || e.safro_curta || e.safro_longa);

    // opcional: normaliza chave para DD/MM (zero à esquerda)
    ENTRIES = ENTRIES.map(e=>{
      const m = e.chave.match(/^(\d{1,2})[\/\-](\d{1,2})$/);
      if(m){
        const dd = m[1].padStart(2,'0');
        const mm = m[2].padStart(2,'0');
        e.chave = `${dd}/${mm}`;
      }
      return e;
    });

    // se houver várias entradas com mesma chave, mantemos todas (uma por linha)
    idx = 0;
  }catch(err){
    console.error(err);
    festLabel.textContent = 'Erro ao carregar a planilha';
  }finally{
    render();
  }
})();
</script>
</body>
</html>
