<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>Domingos dos Falecidos — Qurbono</title>
<meta name="theme-color" content="#6c6f75">
<style>
  :root{
    --bg1:#6c6f75; --bg2:#c9ccd1; --txt:#d6b25a;
    --prata:#b8b8b8; --shadow:rgba(0,0,0,.15);
    --fonte: Arial, Helvetica, sans-serif;
  }
  *{box-sizing:border-box} html,body{height:100%}
  body{
    margin:0; font-family:var(--fonte); color:var(--txt);
    background: linear-gradient(180deg, var(--bg1), var(--bg2));
    display:flex; flex-direction:column; min-height:100vh;
  }
  .wrap{width:100%; max-width:560px; margin:0 auto; padding:8px 14px 10px}
  .title{text-align:center; font-weight:900; font-size:1.8rem; margin:4px 0 6px}
  .hero{display:block; margin:0 auto 12px; max-width:100%; height:auto; max-height:380px;
    border:6px solid var(--prata); box-shadow:0 6px 16px var(--shadow); border-radius:12px}
  .main{
    display:block; width:94%; margin:0 auto 8px; padding:12px 14px; text-align:center; text-decoration:none;
    background:#fff; color:#a07c00; font-weight:900; font-size:1.05rem; border-radius:16px;
    border:3px solid #a07c00; box-shadow: inset 0 0 0 3px var(--prata), 0 6px 14px var(--shadow);
  }
  .nav{display:flex; justify-content:center; gap:10px; margin:8px 0 0}
  .nav button{
    background:#fff; color:#a07c00; font-weight:900; border-radius:12px; border:3px solid var(--prata);
    padding:8px 12px; cursor:pointer; box-shadow: inset 0 0 0 3px rgba(184,184,184,.7), 0 2px 6px var(--shadow)
  }
  .nav button:hover{background:#fffaf1}
  footer{text-align:center; margin-top:14px; padding:10px 0 12px}
  .back{
    background:#a00000;color:#fff;text-decoration:none;border:none;border-radius:8px;padding:.38rem .7rem;font-weight:900;
    transform:scale(0.5); transform-origin:center; display:inline-block;
  }
  .back:hover{background:#c00000}
</style>
</head>
<body>
  <main class="wrap">
    <h1 class="title">Domingos dos Falecidos</h1>
    <img class="hero" src="img/icone-qurbono-falecidos.jpg" alt="">
    <a id="mainLink" class="main" href="#" target="_blank">Carregando…</a>
    <div class="nav">
      <button id="prev">← Anterior</button>
      <button id="next">Próximo →</button>
    </div>
  </main>
  <footer>
    <a class="back" href="javascript:history.back()" onclick="if(!document.referrer||!document.referrer.includes('liturgia-ano.html'))this.href='liturgia-ano.html'">← Voltar</a>
  </footer>

<script>
const CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTSNOwDCcQPyPihUkD8PbrtAmMjV9gcYgCmOXNnAfK6chO41qAAtltEpzl-mlxEvlnMwGQQ-JgKjMI3/pub?gid=1500009651&single=true&output=csv';

const link = document.getElementById('mainLink');
const prevBt = document.getElementById('prev');
const nextBt = document.getElementById('next');

let itens = []; // {label, href, ativo}
let i = 0;

function parseCSV(text){
  const lines = text.split(/\r?\n/).filter(l=>l.trim().length);
  if(!lines.length) return [];
  const header = lines[0].split(',').map(s=>s.trim().toLowerCase());
  const idxRot = header.indexOf('rotulo');
  const idxLink = header.indexOf('link_doc');
  const idxAtv = header.indexOf('ativo');
  const data = [];
  for(let k=1;k<lines.length;k++){
    const cols = lines[k].split(',');
    const rotulo = (cols[idxRot]||'').trim();
    const url = (cols[idxLink]||'').trim();
    const ativo = (cols[idxAtv]||'').trim();
    if(!rotulo) continue;
    data.push({label:rotulo, href:url||'#', ativo: ativo==='1'});
  }
  return data;
}

function firstActiveIndex(list){
  const idx = list.findIndex(x=>x.ativo && x.href && x.href!=='#');
  return idx>=0 ? idx : 0;
}

function render(){
  if(!itens.length){
    link.textContent = 'Sem itens';
    link.href = '#';
    link.style.pointerEvents = 'none';
    link.style.opacity = .6;
    return;
  }
  const cur = itens[i];
  link.textContent = cur.label || '—';
  if(cur.ativo && cur.href && cur.href!=='#'){
    link.href = cur.href;
    link.style.pointerEvents = 'auto';
    link.style.opacity = 1;
    link.title = 'Abrir documento';
  }else{
    link.href = '#';
    link.style.pointerEvents = 'none';
    link.style.opacity = .55;
    link.title = 'Item inativo';
  }
}

function step(delta){
  if(!itens.length) return;
  const n = itens.length;
  for(let k=1;k<=n;k++){
    const j = (i + delta*k + n) % n;
    const it = itens[j];
    if(it.ativo && it.href && it.href!=='#'){ i = j; break; }
    if(k===n){ i = j; }
  }
  render();
}

prevBt.onclick = ()=>step(-1);
nextBt.onclick = ()=>step(1);

fetch(CSV_URL)
  .then(r=>r.text())
  .then(txt=>{
    itens = parseCSV(txt);
    i = firstActiveIndex(itens);
    render();
  })
  .catch(_=>{
    link.textContent = 'Erro ao carregar';
    link.href = '#';
    link.style.pointerEvents = 'none';
    link.style.opacity = .6;
  });
</script>
</body>
</html>
