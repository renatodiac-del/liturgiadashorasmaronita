<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Synaxarion</title>
<meta name="theme-color" content="#a00000">
<style>
:root{
  --ouro:#d6b25a; --ouro-velho:#b08a2e; --bg-ouro-1:#f1e1b6; --bg-ouro-2:#d9b975;
  --vermelho:#a00000; --txt:#2b1f16; --shadow:rgba(0,0,0,.10); --azul-del-rey:#003399; --sans: Arial, Helvetica, sans-serif;
}
*{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%}
body{
  font-family:var(--sans); color:var(--txt); min-height:100vh; position:relative;
  background: linear-gradient(160deg, var(--bg-ouro-1), var(--bg-ouro-2));
}
body::before{
  content:""; position:fixed; inset:0; pointer-events:none; z-index:0; opacity:.55;
  background:
    radial-gradient(#ffffffdd 1.2px, transparent 1.5px) 0 0/10px 10px,
    url("data:image/svg+xml;utf8,\
<svg xmlns='http://www.w3.org/2000/svg' width='520' height='520' viewBox='0 0 520 520'>\
  <defs>\
    <g id='angelHead'>\
      <circle cx='0' cy='0' r='6' fill='rgb(255,255,245)'/>\
      <ellipse cx='0' cy='-8' rx='10' ry='3' fill='none' stroke='rgb(255,248,200)' stroke-width='2'/>\
      <path d='M -12 4 C -2 -2, -2 -2, 0 0 C 2 -2, 2 -2, 12 4' fill='none' stroke='rgb(255,255,245)' stroke-width='2'/>\
      <path d='M -10 7 C -2 1, -2 1, 0 3 C 2 1, 2 1, 10 7' fill='none' stroke='rgb(255,255,245)' stroke-width='2'/>\
    </g>\
  </defs>\n\
  <use href='#angelHead' transform='translate(60,60) scale(1.2)'/>\
  <use href='#angelHead' transform='translate(200,90) scale(0.9)'/>\
  <use href='#angelHead' transform='translate(420,70) scale(1.3)'/>\
  <use href='#angelHead' transform='translate(340,220) scale(1.1)'/>\
  <use href='#angelHead' transform='translate(80,300) scale(1.0)'/>\
  <use href='#angelHead' transform='translate(300,120) scale(1.0)'/>\
  <use href='#angelHead' transform='translate(180,360) scale(1.1)'/>\
  <use href='#angelHead' transform='translate(420,420) scale(0.95)'/>\
</svg>") center/520px 520px repeat;
}

.container{
  max-width:720px; margin:0 auto; width:100%; padding:16px;
  position:relative; z-index:1; display:flex; flex-direction:column; min-height:100dvh;
}
header{ text-align:center; margin-bottom:10px }
h1{
  color:var(--vermelho);
  font-weight:900;
  font-size:calc(1.8rem + 3pt);
  margin:4px 0 2px;
  -webkit-text-stroke:1px var(--ouro-velho);
  text-shadow:-1px -1px 0 var(--ouro-velho), 1px -1px 0 var(--ouro-velho),
              -1px  1px 0 var(--ouro-velho), 1px  1px 0 var(--ouro-velho);
}
.subtitle{ color:#fff; font-weight:700; font-size:calc((1.8rem + 3pt) - 13pt); opacity:.95; }

.hero{
  display:block; margin:10px auto 14px; height:473px; width:auto;
  aspect-ratio:3/4; object-fit:cover; border-radius:14px;
  border:6px solid var(--vermelho);
  box-shadow:0 0 0 6px var(--ouro-velho), 0 8px 16px var(--shadow);
}

/* Data + navegação */
.btn-date{
  display:block; width:50%; margin:0 auto;
  display:flex; align-items:center; justify-content:center; gap:10px;
  min-height:48px; padding:10px 16px; border-radius:18px;
  background:transparent; border:none;
  box-shadow: inset 0 0 0 3px var(--ouro-velho), inset 0 0 0 6px var(--vermelho);
  font-weight:800; color:var(--azul-del-rey); text-decoration:none;
}
.pager{ display:flex; justify-content:center; align-items:center; gap:10px; margin-top:10px; }
.btn-nav{
  display:inline-flex; align-items:center; justify-content:center;
  min-height:44px; padding:8px 14px; border-radius:14px;
  background:transparent; border:none;
  box-shadow: inset 0 0 0 3px var(--ouro-velho), inset 0 0 0 6px var(--vermelho);
  font-weight:800; color:var(--txt); text-decoration:none; cursor:pointer;
}
.btn-nav:focus-visible, .btn-date:focus-visible{
  outline:none; box-shadow:0 0 0 3px rgba(160,0,0,.25),
  inset 0 0 0 3px var(--ouro-velho), inset 0 0 0 6px var(--vermelho)
}

/* Voltar condicional */
.back-wrap{ display:flex; justify-content:center; margin-top:12px; transform:scale(.48); transform-origin:center top; }
.btn-back{
  display:inline-flex; align-items:center; gap:10px;
  background:#a00000; color:#fff; border:none; border-radius:999px;
  padding:10px 16px; font-weight:800; cursor:pointer;
  box-shadow:0 6px 14px var(--shadow);
}
.btn-back .arr{font-size:18px; line-height:1}

.section{ margin:16px 0 24px }
.section .content{ line-height:1.6 }
</style>

<script>
  /* ===================== CONFIG: CSV publicado da aba "synaxarion" ===================== */
  const SYNAX_CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTSNOwDCcQPyPihUkD8PbrtAmMjV9gcYgCmOXNnAfK6chO41qAAtltEpzl-mlxEvlnMwGQQ-JgKjMI3/pub?gid=1675772005&single=true&output=csv';
  /* ==================================================================================== */

  /* ----------------- helpers de URL/data ----------------- */
  function getParam(n){ return new URLSearchParams(location.search).get(n); }
  function setDate(iso){
    const u = new URL(location.href);
    u.searchParams.set('data', iso);
    location.href = u.toString();
  }
  function shiftDate(days){
    const iso = getParam('data') || new Date().toISOString().slice(0,10);
    const d = new Date(iso + 'T00:00:00');
    d.setDate(d.getDate() + days);
    const pad=n=>String(n).padStart(2,'0');
    const next = `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}`;
    setDate(next);
  }
  function goBackOrHome(){
    try{
      const ref = document.referrer || '';
      if(ref.includes('horas-teste.html')){ location.href='horas-teste.html'; return; }
      if(history.length>1){ history.back(); return; }
      location.href='index-teste.html';
    }catch(e){
      location.href='index-teste.html';
    }
  }

  /* ----------------- CSV utils (parser + fetch com fallback) ----------------- */
  function parseCSV(text){
    const rows=[]; let i=0, cur=[], val='', q=false;
    while(i<text.length){
      const c=text[i++];
      if(q){
        if(c==='"' && text[i]==='"'){ val+='"'; i++; }
        else if(c==='"'){ q=false; }
        else val+=c;
      }else{
        if(c===','){ cur.push(val); val=''; }
        else if(c==='"'){ q=true; }
        else if(c==='\n'){ cur.push(val); rows.push(cur); cur=[]; val=''; }
        else if(c!=='\r'){ val+=c; }
      }
    }
    if(val.length||cur.length){ cur.push(val); rows.push(cur); }
    return rows;
  }
  async function fetchCSV(url){
    const cb=Math.floor(Date.now()/60000);
    const u1=url+(url.includes('?')?'&':'?')+'cb='+cb;
    try{
      const r=await fetch(u1,{mode:'cors'});
      if(!r.ok) throw new Error(r.status);
      return await r.text();
    }catch(e){
      const prox='https://api.allorigins.win/raw?url='+encodeURIComponent(u1);
      const r=await fetch(prox);
      if(!r.ok) throw new Error('fallback '+r.status);
      return await r.text();
    }
  }
  const norm = s => (s||'').toString().normalize('NFD').replace(/[\u0300-\u036f]/g,'').trim().toLowerCase();

  // Converte vários formatos da planilha em ISO yyyy-mm-dd
  function toISOfromCSV(val){
    const s=(val||'').toString().trim();

    // 1) DDMMAAAA (8 dígitos sem separador)
    if(/^\d{8}$/.test(s)){
      const dd=s.slice(0,2), mm=s.slice(2,4), yyyy=s.slice(4,8);
      return `${yyyy}-${mm}-${dd}`;
    }

    // 2) dd/mm/aaaa  OU  yyyy/mm/dd (ou com '-' ou '.')
    const t=s.replace(/[-.]/g,'/'); // normaliza separadores
    const parts=t.split('/');
    if(parts.length===3){
      if(parts[0].length===4){ // yyyy/mm/dd
        const [y,m,da]=parts; return `${y.padStart(4,'0')}-${m.padStart(2,'0')}-${da.padStart(2,'0')}`;
      }else{ // dd/mm/yyyy
        const [da,m,y]=parts; return `${y.padStart(4,'0')}-${m.padStart(2,'0')}-${da.padStart(2,'0')}`;
      }
    }

    // 3) já no formato yyyy-mm-dd
    if(/^\d{4}-\d{2}-\d{2}$/.test(s)) return s;

    return null; // formato inesperado
  }

  /* ----------------- carregamento do doc do dia ----------------- */
  async function loadSynaxFor(iso){
    const box=document.getElementById('conteudo');
    box.innerHTML='Carregando…';
    try{
      const txt=await fetchCSV(SYNAX_CSV_URL);
      const rows=parseCSV(txt).filter(r=>r.join('').trim()!=='');
      const head=rows.shift().map(h=>norm(h));
      const idx = names => names.map(n=>head.indexOf(norm(n))).find(i=>i>=0);
      const iDate=idx(['data','date','dia']);
      const iUrl =idx(['url','link','doc','arquivo']);
      const iLab =idx(['label','rotulo','rótulo','titulo','título']);
      const iEn  =idx(['enabled','ativo','publicado']);

      const row = rows.find(r=>{
        const rowIso = toISOfromCSV(r[iDate]);
        const okDate = rowIso === iso;
        const okEn = (iEn<0) || String(r[iEn]||'1').trim()!=='0';
        return okDate && okEn;
      });

      if(!row){ box.innerHTML='<em>Nenhum documento para esta data.</em>'; return; }

      const u=(row[iUrl]||'').trim();
      const lab=(row[iLab]||'Abrir documento').trim();
      if(!u){ box.innerHTML='<em>Documento sem URL.</em>'; return; }

      box.innerHTML = `
        <div style="display:flex;justify-content:center;margin:12px 0">
          <a href="${u}" target="_blank" rel="noopener"
             style="display:inline-flex;align-items:center;gap:10px;padding:10px 16px;border-radius:14px;
                    background:#fff;color:#a00000;font-weight:900;text-decoration:none;
                    box-shadow:0 6px 14px rgba(0,0,0,.10), inset 0 0 0 3px #b08a2e, inset 0 0 0 6px #a00000;">
            <img src="img/cruz3.png" alt="" style="width:26px;height:26px;border-radius:50%;border:2px solid #b08a2e">
            <span>${lab}</span>
          </a>
        </div>`;
    }catch(e){
      console.error(e);
      box.innerHTML='<em>Falha ao carregar planilha do Synaxarion.</em>';
    }
  }

  /* ----------------- boot: data label + carregar conteúdo ----------------- */
  document.addEventListener('DOMContentLoaded', ()=>{
    const iso = getParam('data') || new Date().toISOString().slice(0,10);
    const d = new Date(iso + 'T00:00:00');
    // escreve rótulo da data no botão central
    const opts = { day:'2-digit', month:'long' };
    let label = d.toLocaleDateString('pt-BR', opts);
    label = label.charAt(0).toUpperCase() + label.slice(1);
    const el = document.getElementById('btnData');
    if(el) el.textContent = label;

    // carrega conteúdo do dia
    loadSynaxFor(iso);
  });
</script>
</head>
<body>
  <div class="container">
    <header>
      <h1>Synaxarion</h1>
      <div class="subtitle">sobre a comemoração do dia</div>
      <img class="hero" src="img/icone-synaxarion.jpg" alt="Ícone do Synaxarion" onerror="this.style.display='none'">
    </header>

    <button id="btnData" class="btn-date" type="button" title="Alterar data"></button>

    <div class="pager">
      <button class="btn-nav" type="button" onclick="shiftDate(-1)">← Anterior</button>
      <button class="btn-nav" type="button" onclick="shiftDate(+1)">Próximo →</button>
    </div>

    <div class="back-wrap">
      <button class="btn-back" onclick="goBackOrHome()"><span class="arr">←</span><span>Voltar</span></button>
    </div>

    <section class="section">
      <div id="conteudo" class="content"></div>
    </section>
  </div>
</body>
</html>


