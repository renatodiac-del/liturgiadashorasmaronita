<!-- biblioteca.html — filha de Qurbono, dados vindos da aba biblioteca-qurbono (CSV) -->
<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Biblioteca</title>
  <meta name="theme-color" content="#1a2a40">
  <style>
    :root{
      --azul:#1a2a40;
      --vermelho:#a00000;
      --turquesa:#40E0D0;
      --dourado:#d6b25a;
      --sombra:rgba(0,0,0,.15);
      --fonte: Arial, Helvetica, sans-serif;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family:var(--fonte); color:#1b1b1b;
      background: var(--azul);
      background-image:
        repeating-linear-gradient(45deg, rgba(160,0,0,0.25) 0, rgba(160,0,0,0.25) 2px, transparent 2px, transparent 40px),
        repeating-linear-gradient(-45deg, rgba(160,0,0,0.25) 0, rgba(160,0,0,0.25) 2px, transparent 2px, transparent 40px);
      background-size:40px 40px;
      display:flex; flex-direction:column; min-height:100vh;
    }

    .wrap{
      width:100%; max-width:520px; margin:0 auto;
      padding:4px 12px 10px;
    }

    .title{
      text-align:center;
      font-size: calc(2rem + 2pt);
      font-weight:900;
      color:var(--vermelho);
      margin:4px 0 6px;
      line-height:1.05;
    }

    .hero{
      display:block; margin:0 auto 10px; max-width:100%; height:auto; max-height:420px;
      border:6px solid var(--turquesa);
      box-shadow:0 0 0 4px var(--dourado) inset;
      border-radius:12px
    }

    .buttons{
      display:flex; flex-direction:column; gap:10px;
      margin:0 0 14px 0;
    }

    .btn{
      position:relative; display:flex; align-items:center; justify-content:center; gap:8px;
      cursor:pointer; background-color:rgba(255,255,255,0.95);
      border:2.4px solid var(--turquesa);
      box-shadow:0 0 0 1.6px var(--dourado) inset, 0 4px 10px var(--sombra);
      border-radius:18px;
      padding:9.9px 18px;
      width:92%;
      font-size:1rem; font-weight:bold;
      color:var(--vermelho);
      transition:transform .15s ease, background-color .2s ease, opacity .2s ease;
      text-decoration:none; margin:0 auto;
      text-align:center;
    }
    .btn:hover{transform:scale(1.02); background:#fff3da}

    .btn[aria-disabled="true"]{
      opacity:.55; cursor:not-allowed; pointer-events:none;
    }

    .btn img{
      position:absolute; left:12px;
      width:26px; height:26px;
      border-radius:50%; object-fit:cover;
    }

    footer{
      margin-top:4px; text-align:center; padding:0 0 14px;
    }
    .voltar{
      background:var(--vermelho);
      color:#fff; font-size:.65rem; font-weight:bold;
      border:none; border-radius:6px;
      padding:.3rem .55rem; cursor:pointer;
      display:inline-flex; align-items:center; gap:.4rem;
      text-decoration:none;
      transform:scale(0.6);
      transform-origin:center;
    }
    .voltar:hover{background:#c00000}
  </style>
</head>
<body>
  <main class="wrap">
    <h1 class="title">Biblioteca</h1>

    <!-- Mesmo ícone da página mãe (Qurbono) -->
    <img class="hero" src="img/icone-qurbono.jpg" alt="Ícone Biblioteca" onerror="this.style.display='none'">

    <section class="buttons" id="btnList" aria-label="Biblioteca — coleções">
      <!-- Os botões serão gerados via JS a partir do CSV -->
      <a class="btn" aria-disabled="true"><img src="img/cruz2.jpg" alt=""><span>Carregando…</span></a>
    </section>

    <footer>
      <a class="voltar" href="javascript:history.back()"
         onclick="if(!document.referrer || !document.referrer.includes('qurbono-teste.html')) this.href='qurbono-teste.html'">
        &#8592; Voltar
      </a>
    </footer>
  </main>

<script>
/* ===== CSV publicado da aba biblioteca-qurbono ===== */
const CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTSNOwDCcQPyPihUkD8PbrtAmMjV9gcYgCmOXNnAfK6chO41qAAtltEpzl-mlxEvlnMwGQQ-JgKjMI3/pub?gid=1759728688&single=true&output=csv';

/* CSV parser simples (suporta aspas) */
function parseCSV(text){
  const rows=[]; let i=0, cur='', inQ=false;
  const push=()=>{ (rows.at(-1) ?? rows.push([]), rows.at(-1)).push(cur); cur=''; };
  rows.push([]);
  while(i<text.length){
    const c=text[i];
    if(inQ){
      if(c==='"' && text[i+1]==='"'){ cur+='"'; i+=2; continue; }
      if(c==='"'){ inQ=false; i++; continue; }
      cur+=c; i++; continue;
    }else{
      if(c === '"'){ inQ=true; i++; continue; }
      if(c === ','){ push(); i++; continue; }
      if(c === '\r'){ i++; continue; }
      if(c === '\n'){ push(); rows.push([]); i++; continue; }
      cur+=c; i++; continue;
    }
  }
  (rows.at(-1)||rows.push([])).length || rows.pop();
  return rows;
}

/* Monta um <a> botão a partir do registro */
function makeBtn({rotulo, link, ativo}){
  const a = document.createElement('a');
  a.className = 'btn';
  a.target = '_blank';
  a.rel = 'noopener';
  const img = document.createElement('img');
  img.src = 'img/cruz2.jpg';
  img.alt = '';
  const span = document.createElement('span');
  span.textContent = rotulo || '—';
  a.appendChild(img);
  a.appendChild(span);

  const enabled = (String(ativo).trim() === '1') && link;
  if(enabled){
    a.href = link;
  }else{
    a.setAttribute('aria-disabled','true');
  }
  return a;
}

/* Carrega CSV e popula a lista */
(function(){
  const list = document.getElementById('btnList');
  fetch(CSV_URL)
    .then(r=>r.text())
    .then(txt=>{
      const rows = parseCSV(txt).filter(r=>r.length && r.some(c=>String(c).trim()!==''));
      if(!rows.length) throw new Error('CSV vazio');

      const header = rows[0].map(h=>String(h).trim().toLowerCase());
      const idx = {
        ordem:   header.indexOf('ordem'),
        rotulo:  header.indexOf('rotulo'),
        key:     header.indexOf('key'),
        link:    header.indexOf('link_doc'),
        ativo:   header.indexOf('ativo'),
        obs:     header.indexOf('obs')
      };
      if(idx.ordem<0 || idx.rotulo<0 || idx.link<0 || idx.ativo<0){
        throw new Error('Cabeçalho esperado: ordem, rotulo, key, link_doc, ativo (obs opcional)');
      }

      const items = [];
      for(let i=1;i<rows.length;i++){
        const r = rows[i];
        const ordem = parseInt((r[idx.ordem]||'').toString().trim(),10);
        const rotulo = (r[idx.rotulo]||'').toString().trim();
        const link = (r[idx.link]||'').toString().trim();
        const ativo = (r[idx.ativo]||'').toString().trim();
        if(!Number.isFinite(ordem)) continue;
        items.push({ordem, rotulo, link, ativo});
      }

      items.sort((a,b)=>a.ordem-b.ordem);

      list.innerHTML = ''; // limpa placeholder
      if(!items.length){
        const off = document.createElement('a');
        off.className = 'btn';
        off.setAttribute('aria-disabled','true');
        off.innerHTML = '<img src="img/cruz2.jpg" alt=""><span>Sem itens disponíveis</span>';
        list.appendChild(off);
        return;
      }

      items.forEach(it => list.appendChild(makeBtn(it)));
    })
    .catch(err=>{
      console.error('Falha ao carregar CSV:', err);
      // Mantém um botão informativo
      list.innerHTML = '';
      const off = document.createElement('a');
      off.className = 'btn';
      off.setAttribute('aria-disabled','true');
      off.innerHTML = '<img src="img/cruz2.jpg" alt=""><span>Não foi possível carregar a lista</span>';
      list.appendChild(off);
    });
})();
</script>
</body>
</html>

