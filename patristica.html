<!-- patristica.html — versão completa com parser robusto + links ativos + ícones por autor -->
<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>Patrística Siríaca</title>
<style>
:root{--areia-clara:#efe1c7;--areia-media:#e6d6b4;--areia-escura:#c2a772;--ouro:#b4923a;--preto:#111;--shadow:rgba(0,0,0,.18);--sans:Arial,Helvetica,sans-serif;--vermelho:#a00000;}
*{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%}
body{font-family:var(--sans);color:#2b2114;background:radial-gradient(1px 1px at 15% 25%,rgba(255,255,255,.8),transparent 60%),radial-gradient(1px 1px at 75% 12%,rgba(255,255,255,.75),transparent 60%),radial-gradient(1px 1px at 55% 70%,rgba(255,255,255,.7),transparent 60%),radial-gradient(1px 1px at 28% 58%,rgba(255,255,255,.8),transparent 60%),linear-gradient(to top,var(--areia-escura),var(--areia-media),var(--areia-clara));display:flex;flex-direction:column;min-height:100vh}
.wrap{max-width:640px;margin:0 auto;padding:12px 16px 22px;width:100%}
.title{text-align:center;font-size:calc(1.9rem + 3pt);font-weight:900;color:var(--preto);text-shadow:-1px -1px 0 var(--ouro),1px -1px 0 var(--ouro),-1px 1px 0 var(--ouro),1px 1px 0 var(--ouro);margin-bottom:8px}
.hero{display:block;margin:8px auto 16px;max-width:100%;width:100%;height:260px;object-fit:contain;border:6px solid var(--ouro);border-radius:40% / 18%;box-shadow:0 8px 18px var(--shadow);background:#fff7e6}
.centerbox{display:flex;flex-direction:column;align-items:center;gap:14px}
.nameBtn{display:flex;align-items:center;justify-content:center;text-align:center;padding:12px 20px;min-width:260px;border-radius:16px;background:#fff;color:#2b2114;font-weight:900;font-size:calc(1.15rem + 2pt);cursor:pointer;user-select:none;border:3px solid var(--ouro);box-shadow:inset 0 0 0 3px rgba(180,146,58,.55),0 3px 8px var(--shadow);transition:transform .12s,background-color .2s}
.nameBtn:hover{transform:scale(1.02);background:#fffdf4}
.navrow{display:flex;justify-content:center;gap:14px;margin-top:10px}
.navbtn{background:#fff;color:#2b2114;font-weight:900;padding:9px 14px;border-radius:12px;cursor:pointer;border:3px solid var(--ouro);box-shadow:inset 0 0 0 3px rgba(180,146,58,.5),0 2px 6px var(--shadow);transition:background-color .2s,transform .12s}
.navbtn:hover{background:#fffdf1;transform:translateY(-1px)}
.actions{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:14px;width:100%}
.actionBtn{display:flex;align-items:center;justify-content:center;text-align:center;min-height:64px;padding:12px;border-radius:14px;text-decoration:none;background:#fff;color:#2b2114;font-weight:800;border:3px solid var(--ouro);box-shadow:inset 0 0 0 3px rgba(180,146,58,.45),0 3px 8px var(--shadow)}
.actionBtn[aria-disabled="true"]{opacity:.45;pointer-events:none}
.alert{margin:10px auto;width:90%;max-width:520px;background:#fff3cd;color:#7c5b00;border:1px solid #ffe08a;padding:6px 10px;font-size:.9rem;border-radius:8px;text-align:center;display:none}
footer{margin-top:auto;padding:16px 0 36px;text-align:center}
.voltar{background:var(--vermelho);color:#fff;font-size:.65rem;font-weight:bold;border:none;border-radius:6px;padding:.3rem .55rem;cursor:pointer;display:inline-flex;align-items:center;gap:.4rem;text-decoration:none;transform:scale(0.6);transform-origin:center}
.voltar:hover{background:#c00000}
</style>
</head>
<body>
  <main class="wrap">
    <h1 class="title">Patrística Siríaca</h1>
    <img id="hero" class="hero" src="img/icone-patristica.png" alt="Patrística Siríaca" onerror="this.src='img/icone-patristica.png';this.onerror=null;">
    <div id="alert" class="alert"></div>
    <section class="centerbox" aria-label="Autores">
      <button id="nameBtn" class="nameBtn" type="button">—</button>
      <div class="navrow">
        <button id="prev" class="navbtn" type="button">← Anterior</button>
        <button id="next" class="navbtn" type="button">Próximo →</button>
      </div>
    </section>
    <section id="actions" class="actions" aria-label="Links do autor"></section>
  </main>
  <footer>
    <a class="voltar" href="javascript:history.back()">&#8592; Voltar</a>
    <div style="margin-top:8px;color:#5b4b1c;font-size:.9rem">Patrística — <strong>FINALIZADO</strong></div>
  </footer>
<script>
// CSVs publicados
const CSV_AUTHORS="https://docs.google.com/spreadsheets/d/e/2PACX-1vTSNOwDCcQPyPihUkD8PbrtAmMjV9gcYgCmOXNnAfK6chO41qAAtltEpzl-mlxEvlnMwGQQ-JgKjMI3/pub?gid=161703440&single=true&output=csv";
const CSV_LINKS  ="https://docs.google.com/spreadsheets/d/e/2PACX-1vTSNOwDCcQPyPihUkD8PbrtAmMjV9gcYgCmOXNnAfK6chO41qAAtltEpzl-mlxEvlnMwGQQ-JgKjMI3/pub?gid=101845558&single=true&output=csv";

// Botões fixos
const BUTTON_ORDER=['biografia','homilias','hinos','obras'];
const LABELS={biografia:'Biografia',homilias:'Homilias',hinos:'Hinos',obras:'Obras selecionadas'};

// Ícones por autor (fallback se a planilha não trouxer a coluna "icon")
const ICON_BY_SLUG={
  'santo-efrem':'efrem.png',
  'narsai-de-nisibis':'narsai-nisibis.png',
  'jaco-de-serugh':'jaco-serugh.png',
  'isaque-de-ninive':'isaque-ninive.jpeg'
};

// Utils
function parseCSV(text){
  text = text.replace(/^﻿/, '');
  const lines=text.split(/
?
/).filter(l=>l.trim()!=='');
  const rows=[]; for(const line of lines){ let cur='',q=false; const out=[]; for(let i=0;i<line.length;i++){ const c=line[i]; if(c==='"'){ if(q && line[i+1]==='"'){ cur+='"'; i++; } else { q=!q; } } else if(c===',' && !q){ out.push(cur); cur=''; } else { cur+=c; } } out.push(cur); rows.push(out.map(x=>x.trim())); } return rows;
}
async function fetchCSV(url){ const r=await fetch(url+(url.includes('?')?'&':'?')+'t='+Date.now(),{cache:'no-store'}); if(!r.ok) throw new Error('CSV '+r.status); const txt=await r.text(); const [head,...rows]=parseCSV(txt); const map=Object.fromEntries(head.map((h,i)=>[h.trim(),i])); return {rows,map,head}; }
function slugify(s){return (s||'').normalize('NFD').replace(/[̀-ͯ]/g,'').toLowerCase().replace(/[^a-z0-9]+/g,'-').replace(/^-+|-+$/g,'');}

// Estado
let autores=[],linksMap={},idx=0;
const hero=document.getElementById('hero');
const alertBox=document.getElementById('alert');
const nameBtn=document.getElementById('nameBtn');
const prevBt=document.getElementById('prev');
const nextBt=document.getElementById('next');
const actions=document.getElementById('actions');

function updateHero(a){
  const file = (a.icon && a.icon.trim()) || ICON_BY_SLUG[a.author_slug] || 'icone-patristica.png';
  hero.alt = a.author_name || 'Patrística Siríaca';
  hero.src = 'img/'+file;
}

function render(){
  if(!autores.length){ nameBtn.textContent='—'; actions.innerHTML=''; return; }
  const a=autores[idx];
  nameBtn.textContent=a.author_name||'—';
  updateHero(a);
  actions.innerHTML='';
  const byAuthor=linksMap[a.author_slug]||{};
  BUTTON_ORDER.forEach(k=>{
    const d=byAuthor[k]||{label:LABELS[k],url:'',enabled:'0'};
    const b=document.createElement('a');
    b.className='actionBtn';
    b.textContent=d.label||LABELS[k]||k;
    const isOn=d.url && String(d.enabled).trim()==='1';
    if(isOn){ b.href=d.url; b.target='_blank'; b.rel='noopener'; }
    else { b.href='#'; b.setAttribute('aria-disabled','true'); }
    actions.appendChild(b);
  });
}

function openPrimary(){
  if(!autores.length) return;
  const a=autores[idx];
  const byAuthor=linksMap[a.author_slug]||{};
  for(const k of BUTTON_ORDER){ const d=byAuthor[k]; if(d && d.url && String(d.enabled).trim()==='1'){ window.open(d.url,'_blank'); return; } }
  location.hash=a.author_slug||'#';
}

nameBtn.addEventListener('click',openPrimary);
prevBt.addEventListener('click',()=>{ if(!autores.length) return; idx=(idx-1+autores.length)%autores.length; render(); });
nextBt.addEventListener('click',()=>{ if(!autores.length) return; idx=(idx+1)%autores.length; render(); });

(async()=>{
  try{
    // Autores
    const {rows:ras,map:ma,head:ha}=await fetchCSV(CSV_AUTHORS);
    if(ma.author_name==null) throw new Error('Cabeçalho "author_name" ausente. Cabeçalhos: '+ha.join(', '));
    autores = ras
      .filter(r=> String(r[ma.enabled]||'').trim()==='1' && (r[ma.author_name]||'').trim()!=='')
      .map(r=>({
        author_name:(r[ma.author_name]||'').trim(),
        author_slug: ((ma.author_slug!=null?(r[ma.author_slug]||''):'').trim()) || slugify(r[ma.author_name]||''),
        icon: (ma.icon!=null ? (r[ma.icon]||'').trim() : '')
      }));

    // Links
    const {rows:rls,map:ml,head:hl}=await fetchCSV(CSV_LINKS);
    if(ml.author_slug==null||ml.button_key==null) throw new Error('Cabeçalhos mínimos ausentes em patristica-links. Recebido: '+hl.join(', '));
    linksMap={};
    rls.forEach(r=>{
      const as=(r[ml.author_slug]||'').trim(); if(!as) return;
      const key=(r[ml.button_key]||'').trim().toLowerCase(); if(!key) return;
      (linksMap[as] ||= {});
      linksMap[as][key]={
        label: (ml.label!=null?(r[ml.label]||''):'').trim() || LABELS[key] || key,
        url: (ml.url!=null?(r[ml.url]||''):'').trim(),
        enabled: String(ml.enabled!=null?(r[ml.enabled]||'1'):'1').trim()
      };
    });

    // Autor inicial
    const h=(location.hash||'').replace(/^#/,'');
    const pos=h?autores.findIndex(x=>x.author_slug===h):-1; idx=pos>=0?pos:0;
    alertBox.style.display='none';
  }catch(e){
    console.warn('[Patrística] Falha CSV, usando fallback:', e);
    alertBox.textContent='Não foi possível carregar a planilha. Usando lista local provisória.';
    alertBox.style.display='block';
    autores=[
      {author_name:'Santo Efrém',author_slug:'santo-efrem',icon:'efrem.png'},
      {author_name:'Narsai de Nisibis',author_slug:'narsai-de-nisibis',icon:'narsai-nisibis.png'},
      {author_name:'Jacó de Serugh',author_slug:'jaco-de-serugh',icon:'jaco-serugh.png'},
      {author_name:'Isaque de Nínive',author_slug:'isaque-de-ninive',icon:'isaque-ninive.jpeg'}
    ];
    linksMap={};
  }
  render();
})();
</script>
</body>
</html>


