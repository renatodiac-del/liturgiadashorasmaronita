<!-- calendario.html — integrado ao Google Sheets (CSV) com 3 botões (2024, 2025, 2026) -->
<section id="anos" class="grid-3" aria-label="Calendários por ano">
<!-- preenchido via JS -->
</section>
</div>


<script>
// URL pública da aba "calendario" (CSV)
const CSV_CALEND = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTSNOwDCcQPyPihUkD8PbrtAmMjV9gcYgCmOXNnAfK6chO41qAAtltEpzl-mlxEvlnMwGQQ-JgKjMI3/pub?gid=630771061&single=true&output=csv';


// utilidades
const $ = (s,el=document)=>el.querySelector(s);
const csvToRows = (csv)=>csv.trim().split(/\r?\n/).map(l=>l.split(/,(?=(?:[^"]*"[^"]*")*[^"]*$)/).map(s=>s.replace(/^"|"$/g,'')));
async function loadCSV(url){ const r=await fetch(url+'&t='+Date.now(),{cache:'no-store'}); if(!r.ok) throw new Error('CSV'); const t=await r.text(); const [h,...rs]=csvToRows(t); return rs.map(r=>Object.fromEntries(h.map((k,i)=>[k.trim(),(r[i]||'').trim()]))); }


// Voltar com fallback simples → index-teste.html se não houver histórico
(function(){ const b=$('#btn-voltar'); if(!b) return; b.onclick=(e)=>{ e.preventDefault(); const ref=document.referrer||''; if(ref){ history.back(); } else { location.href='index-teste.html?from=fallback'; } }; })();


(async function(){
const rows = await loadCSV(CSV_CALEND);
// Esperado: module,page,button_key,url,enabled
// Filtra só linhas enabled
const enabled = rows.filter(r=> (r.enabled==1||r.enabled==='1') );
// Ordena pela chave (ano_YYYY)
enabled.sort((a,b)=> (a.button_key||'').localeCompare(b.button_key||''));
const box = document.getElementById('anos'); box.innerHTML='';
const labels = { ano_2024:'Calendário 2024', ano_2025:'Calendário 2025', ano_2026:'Calendário 2026' };
enabled.forEach(it=>{
const a=document.createElement('a');
a.className='card';
const lbl = labels[it.button_key] || (it.button_key||'').replace('ano_','Calendário ');
a.textContent = lbl;
if(it.url){ a.href=it.url; a.target='_blank'; a.rel='noopener'; }
else { a.href='#'; a.setAttribute('aria-disabled','true'); }
box.appendChild(a);
});
})();
</script>
</body>
</html>
