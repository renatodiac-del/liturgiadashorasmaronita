<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>Leituras Bíblicas</title>
<meta name="theme-color" content="#cfeefe">
<style>
:root{
  --azulbebe:#cfeefe; 
  --navy:#0b2a4d; 
  --dourado:#d6b25a; 
  --ouro-velho:#b08a2e; 
  --ouro-velho-rgb:176,138,46;
  --azul-del-rey:#003399;
  --ink:#0d233b; 
  --sombra:rgba(0,0,0,.12);
  --vermelho:#a00000;
  --fonte: Arial, Helvetica, sans-serif;
}
html{font-size:120%}
*{box-sizing:border-box} 
html,body{height:100%}
body{
  margin:0;font-family:var(--fonte); background:var(--azulbebe); color:var(--ink);
  background-image:
    repeating-linear-gradient(45deg, rgba(var(--ouro-velho-rgb),.20) 0, rgba(var(--ouro-velho-rgb),.20) 2px, transparent 2px, transparent 40px),
    repeating-linear-gradient(-45deg, rgba(var(--ouro-velho-rgb),.16) 0, rgba(var(--ouro-velho-rgb),.16) 2px, transparent 2px, transparent 40px);
  background-size:40px 40px; 
  display:flex; flex-direction:column; min-height:100vh;
}

/* Cabeçalho */
header{display:flex;flex-direction:column;align-items:center;text-align:center;padding:12px 12px 0}
.title{
  color:var(--dourado);
  font-weight:900;
  font-size:calc(1.8rem + 3pt);
  margin:0;
  -webkit-text-stroke:1px var(--azul-del-rey);
  text-shadow:
    -1px -1px 0 var(--azul-del-rey),
     1px -1px 0 var(--azul-del-rey),
    -1px  1px 0 var(--azul-del-rey),
     1px  1px 0 var(--azul-del-rey);
}
.subtitle{
  margin-top:4px;
  color:var(--azul-del-rey);
  font-weight:800;
  font-style:italic;
  font-size:calc( (1.8rem + 3pt) - 15pt );
  -webkit-text-stroke:.8px var(--ouro-velho);
  text-shadow:
    -1px -1px 0 var(--ouro-velho),
     1px -1px 0 var(--ouro-velho),
    -1px  1px 0 var(--ouro-velho),
     1px  1px 0 var(--ouro-velho);
}

.wrap{max-width:640px;margin:0 auto;padding:10px 16px 24px}

/* Ícone com borda dourada — +20% (420px → 504px) */
.hero{
  display:block;margin:8px auto 16px;max-width:100%;height:auto;max-height:504px;
  border:6px solid var(--dourado); 
  box-shadow:0 0 0 4px rgba(214,178,90,.45) inset, 0 6px 16px var(--sombra);
  border-radius:14px
}
.hero[hidden]{display:none}

/* Aro duplo (externo azul del-rey, interno dourado) para todos os botões */
.aro-duplo{
  border:3px solid var(--azul-del-rey);
  box-shadow:
    inset 0 0 0 3px var(--dourado),
    0 2px 6px var(--sombra);
}

/* Linha do botão de DATA (sozinho) */
.datebox{
  display:flex; align-items:center; justify-content:center;
  margin:10px 0 6px;
}

/* Botão de DATA (duas linhas) — altura -25% */
.datebtn{
  display:flex; flex-direction:column; align-items:center; justify-content:center;
  min-width:230px; padding:7.5px 16px; border-radius:14px; background:#fff; 
  font-weight:900; text-align:center; line-height:1.2;
  transition:opacity .2s ease, transform .12s ease, background-color .2s ease;
}
.datebtn .date{
  font-size:calc(1.25rem - 2pt);
  color:var(--ouro-velho);
}
.datebtn .weekday{
  font-size:1rem; font-weight:800; color:#27466a; text-transform:capitalize
}
.datebtn[aria-disabled="true"]{opacity:.55; cursor:not-allowed}

/* Rótulo extra (se houver na planilha) */
.extra{
  display:block; margin-top:2px; font-size:.92rem; font-weight:700; color:#27466a;
}

/* Navegação */
.navrow{
  display:flex; align-items:center; justify-content:center;
  gap:6px; margin-top:6px;
}
.navbtn{
  appearance:none;background:#fff;color:var(--navy);cursor:pointer;
  padding:8px 12px;border-radius:12px;font-weight:900;
  transition:transform .12s ease, background-color .2s ease;
}
.navbtn:hover{background:#f4fbff;transform:translateY(-1px)}

/* Voltar (padrão) */
.back-wrap{
  display:flex; justify-content:center;
  margin-top:min(3.6vh, 28px);
  transform:scale(.48); transform-origin:center top;
}
.btn-back{
  display:inline-flex; align-items:center; gap:10px;
  background:var(--vermelho); color:#fff; border:none; border-radius:999px;
  padding:10px 16px; font-weight:800; cursor:pointer;
  box-shadow:0 6px 14px var(--sombra);
}
.btn-back .arr{font-size:18px; line-height:1}
</style>
</head>
<body>
<header>
  <h1 class="title">Leituras Bíblicas</h1>
  <div class="subtitle">para a Qurbono</div>
</header>

<main class="wrap">
  <img class="hero" id="hero" src="img/icone-leituras.png" alt="Ícone — Leituras"
       onerror="this.hidden=true">

  <!-- Botão de DATA -->
  <div class="datebox" aria-label="Data do dia">
    <button id="datebtn" class="datebtn aro-duplo" type="button" aria-label="Data e dia da semana" aria-disabled="true">
      <span class="date">--/--/----</span>
      <span class="weekday">-</span>
      <span class="extra" id="extra" hidden></span>
    </button>
  </div>

  <!-- Navegação -->
  <div class="navrow" aria-label="Navegação por data">
    <button id="prev" class="navbtn aro-duplo" type="button">← Anterior</button>
    <button id="next" class="navbtn aro-duplo" type="button">Próximo →</button>
  </div>

  <!-- Voltar -->
  <div class="back-wrap">
    <button class="btn-back" type="button" onclick="goBackOrHome()">
      <span class="arr">←</span><span>Voltar</span>
    </button>
  </div>
</main>

<script>
/* ====== CONFIG: Link CSV publicado da aba `leituras-qurbono-data`
   Cabeçalho esperado: data (DD/MM/AAAA), link_doc, ativo
   Opcionais: rotulo, obs
====== */
const CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTSNOwDCcQPyPihUkD8PbrtAmMjV9gcYgCmOXNnAfK6chO41qAAtltEpzl-mlxEvlnMwGQQ-JgKjMI3/pub?gid=1245725725&single=true&output=csv';

/* ====== Utilitários ====== */
function goBackOrHome(){
  try{
    if(history.length>1) history.back();
    else location.href='index-teste.html';
  }catch(e){
    location.href='index-teste.html';
  }
}
function pad2(n){return String(n).padStart(2,'0');}
function toISODateLocal(d){
  const y=d.getFullYear(), m=pad2(d.getMonth()+1), day=pad2(d.getDate());
  return `${y}-${m}-${day}`;
}
function fmtDateBR(d){ return `${pad2(d.getDate())}/${pad2(d.getMonth()+1)}/${d.getFullYear()}`; }
function fmtWeekdayBR(d){
  const wd = d.toLocaleDateString('pt-BR',{weekday:'long'});
  return wd.charAt(0).toUpperCase()+wd.slice(1);
}
/* Converte "DD/MM/AAAA" -> "AAAA-MM-DD" */
function brToISO(br){
  const m = /^(\d{2})\/(\d{2})\/(\d{4})$/.exec((br||'').trim());
  if(!m) return null;
  const [_, dd, mm, yyyy] = m;
  return `${yyyy}-${mm}-${dd}`;
}
function parseCSV(text){
  const rows=[]; let i=0, cur='', inQ=false;
  const push=()=>{(rows.at(-1)??rows.push([]),rows.at(-1)).push(cur); cur='';};
  rows.push([]);
  while(i<text.length){
    const c=text[i];
    if(inQ){
      if(c==='"' && text[i+1]==='"'){ cur+='"'; i+=2; continue; }
      if(c==='"'){ inQ=false; i++; continue; }
      cur+=c; i++; continue;
    }else{
      if(c==='\"'){ inQ=true; i++; continue; }
      if(c===','){ push(); i++; continue; }
      if(c==='\r'){ i++; continue; }
      if(c==='\n'){ push(); rows.push([]); i++; continue; }
      cur+=c; i++; continue;
    }
  }
  (rows.at(-1)||rows.push([])).length || rows.pop();
  return rows;
}

/* ====== Estado e elementos ====== */
let current = new Date();
const dateBtn = document.getElementById('datebtn');
const extraEl = document.getElementById('extra');
const prevBt  = document.getElementById('prev');
const nextBt  = document.getElementById('next');

const DATA_MAP = new Map(); // key: ISO -> {rotulo, link_doc, ativo}

/* ====== Renderização ====== */
function render(){
  const br = fmtDateBR(current);
  const wd = fmtWeekdayBR(current);
  const iso = toISODateLocal(current);

  const rec = DATA_MAP.get(iso);
  const has = !!(rec && rec.link_doc && String(rec.ativo)==='1');

  dateBtn.querySelector('.date').textContent = br;
  dateBtn.querySelector('.weekday').textContent = wd;

  const rot = rec && rec.rotulo ? rec.rotulo.trim() : '';
  if(rot){
    extraEl.hidden = false;
    extraEl.textContent = rot;
  }else{
    extraEl.hidden = true;
    extraEl.textContent = '';
  }

  if(has){
    dateBtn.removeAttribute('aria-disabled');
    dateBtn.title = 'Abrir as leituras deste dia';
    dateBtn.style.pointerEvents = 'auto';
    dateBtn.style.opacity = '1';
  }else{
    dateBtn.setAttribute('aria-disabled','true');
    dateBtn.title = 'Sem link configurado para este dia';
    dateBtn.style.pointerEvents = 'none';
    dateBtn.style.opacity = '.55';
  }
}

/* ====== Navegação ====== */
prevBt.addEventListener('click', ()=>{ current.setDate(current.getDate()-1); render(); });
nextBt.addEventListener('click', ()=>{ current.setDate(current.getDate()+1); render(); });

dateBtn.addEventListener('click', ()=>{
  if(dateBtn.getAttribute('aria-disabled')==='true') return;
  const iso = toISODateLocal(current);
  const rec = DATA_MAP.get(iso);
  if(rec && rec.link_doc) window.open(rec.link_doc,'_blank','noopener');
});
dateBtn.addEventListener('keydown', (e)=>{
  if(e.key==='Enter' || e.key===' '){
    e.preventDefault();
    dateBtn.click();
  }
});

/* ====== Carregar CSV ====== */
fetch(CSV_URL)
  .then(r=>r.text())
  .then(txt=>{
    const rows = parseCSV(txt).filter(r=>r.length && r.some(c=>c.trim()!==''));
    if(!rows.length) throw new Error('CSV vazio');

    const header = rows[0].map(h=>h.trim().toLowerCase());
    const col = {
      data:    header.indexOf('data'),      // DD/MM/AAAA
      rotulo:  header.indexOf('rotulo'),
      link:    header.indexOf('link_doc'),
      ativo:   header.indexOf('ativo'),
      obs:     header.indexOf('obs')
    };
    if(col.data<0 || col.link<0 || col.ativo<0){
      throw new Error('Cabeçalho esperado: data, link_doc, ativo (rotulo e obs opcionais).');
    }

    for(let i=1;i<rows.length;i++){
      const r=rows[i];
      const br = (r[col.data]||'').trim();
      const iso = brToISO(br);
      if(!iso) continue;

      const rotulo = (col.rotulo>=0 ? (r[col.rotulo]||'').trim() : '');
      const link   = (r[col.link]||'').trim();
      const ativo  = String((r[col.ativo]||'').trim());
      DATA_MAP.set(iso,{rotulo, link_doc:link, ativo});
    }
    render();
  })
  .catch(err=>{
    console.error('Falha ao carregar CSV:', err);
    render();
  });
</script>
</body>
</html>
