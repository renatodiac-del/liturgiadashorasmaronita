<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>6º Domingo — Cura do Cego Bartimeu · Quaresma</title>
<meta name="theme-color" content="#3a0c6e">
<style>
:root{ --roxo:#3a0c6e; --bordo:#6e0d25; --prata:#b0b0b0; --branco:#ffffff; --shadow:rgba(0,0,0,.16); --fonte:Arial, Helvetica, sans-serif; --btnIcon:29.6px;}
*{box-sizing:border-box;margin:0;padding:0} html,body{height:100%}
body{font-family:var(--fonte);background:linear-gradient(to top, var(--roxo) 0%, #5a2385 46%, #8e2e4a 78%, var(--bordo) 100%);min-height:100vh;display:flex;flex-direction:column;overflow-x:hidden;position:relative}
header{text-align:center;padding:24px 10px 8px}
.title{color:var(--prata);font-weight:900;font-size:1.9rem;text-shadow:-1px -1px 0 var(--branco),1px -1px 0 var(--branco),-1px 1px 0 var(--branco),1px 1px 0 var(--branco)}
.wrap{max-width:640px;margin:0 auto;padding:12px 16px 22px;width:100%}
.hero{display:block;margin:10px auto 16px;height:360px;width:auto;aspect-ratio:3/4;object-fit:cover;max-height:560px;border:4px solid var(--prata);box-shadow:inset 0 0 0 4px var(--branco),0 8px 16px var(--shadow);border-radius:14px}
.list{display:flex;flex-direction:column;gap:12px;margin-top:6px}
.btn{display:grid;grid-template-columns:var(--btnIcon) 1fr var(--btnIcon);align-items:center;text-align:center;background:linear-gradient(to top,#fff 0%,#fffaf9 60%,#ffffff 100%);color:var(--prata);text-decoration:none;font-weight:900;border:3px solid var(--prata);box-shadow:inset 0 0 0 3px var(--branco),0 4px 10px var(--shadow);border-radius:18px;padding:6px 18px;width:94%;margin:0 auto;transition:transform .12s,filter .2s}
.btn:hover{transform:scale(1.02);filter:brightness(1.05)}
.btn .icon{width:var(--btnIcon);height:var(--btnIcon);border-radius:50%;border:2px solid var(--prata);box-shadow:inset 0 0 0 2px var(--branco);object-fit:cover}
.btn .label{ text-align:center;color:var(--prata); text-shadow:-1px -1px 0 var(--branco),1px -1px 0 var(--branco),-1px 1px 0 var(--branco),1px 1px 0 var(--branco)}
.btn .slot{width:var(--btnIcon);height:var(--btnIcon)}
.back-wrap{display:flex;justify-content:center;margin-top:6px;transform:scale(.48);transform-origin:center top}
.btn-back{display:inline-flex;align-items:center;gap:10px;background:#a00000;color:#fff;border:none;border-radius:999px;padding:10px 16px;font-weight:800;box-shadow:0 6px 14px var(--shadow);cursor:pointer}
.btn-back .arr{font-size:18px;line-height:1}
</style>
<script>
function goBackOrMother(){
  try{
    if (document.referrer && document.referrer.includes('quaresma.html')) { history.back(); return; }
    if (history.length>1) { history.back(); return; }
  }catch(e){}
  location.href='quaresma.html';
}
</script>
</head>
<body>
<header><h1 class="title">6º Domingo — Cura do Cego Bartimeu</h1></header>

<main class="wrap">
  <img class="hero" src="img/icone-quaresma-bartimeu.png" alt="Ícone — Cura do Cego Bartimeu" onerror="this.style.display='none'">

  <section class="list" aria-label="Ofícios">
    <a class="btn" data-key="ramsho-curta" href="#"><img class="icon" src="img/icone-quaresma-bartimeu.png" alt=""><span class="label">Ramsho — versão curta</span><span class="slot"></span></a>
    <a class="btn" data-key="ramsho-longa" href="#"><img class="icon" src="img/icone-quaresma-bartimeu.png" alt=""><span class="label">Ramsho — versão longa</span><span class="slot"></span></a>
    <a class="btn" data-key="safro-curta"  href="#"><img class="icon" src="img/icone-quaresma-bartimeu.png" alt=""><span class="label">Safro — versão curta</span><span class="slot"></span></a>
    <a class="btn" data-key="safro-longa"  href="#"><img class="icon" src="img/icone-quaresma-bartimeu.png" alt=""><span class="label">Safro — versão longa</span><span class="slot"></span></a>
    <a class="btn" data-key="salmos-leituras" href="#"><img class="icon" src="img/icone-quaresma-bartimeu.png" alt=""><span class="label">Salmos e Leituras</span><span class="slot"></span></a>
  </section>

  <div class="back-wrap"><button class="btn-back" onclick="goBackOrMother()"><span class="arr">←</span><span>Voltar</span></button></div>
</main>

<script>
// === Config da planilha (CSV publicado) ===
const CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTSNOwDCcQPyPihUkD8PbrtAmMjV9gcYgCmOXNnAfK6chO41qAAtltEpzl-mlxEvlnMwGQQ-JgKjMI3/pub?gid=1354083639&single=true&output=csv';
// ATENÇÃO: usar exatamente o slug como está na coluna A (com o "domigo" mesmo)
const SLUG_MAIN   = '6 domigo quaresma';
const SLUG_SALMOS = 'leituras 6 semana quaresma';

// === Parser CSV robusto ===
function csvToRows(text){
  const rows=[]; let cur=[]; let cell=''; let q=false;
  for(let i=0;i<text.length;i++){
    const c=text[i], n=text[i+1];
    if(q){
      if(c==='"' && n==='"'){ cell+='"'; i++; }
      else if(c==='"'){ q=false; }
      else { cell+=c; }
    }else{
      if(c==='"'){ q=true; }
      else if(c===','){ cur.push(cell); cell=''; }
      else if(c==='\n'){ cur.push(cell); rows.push(cur); cur=[]; cell=''; }
      else if(c==='\r'){ /* ignore */ }
      else { cell+=c; }
    }
  }
  cur.push(cell); rows.push(cur);
  return rows.filter(r=>r.length && (r.some(x=>x!=='')));
}

// === Mapeamento por slug ===
function mapBySlug(rows){
  const by={};
  for(let r=1;r<rows.length;r++){
    const row=rows[r];
    const slug=(row[0]||'').toLowerCase().trim();
    if(!slug) continue;
    by[slug]={
      ramshoCurta: row[2]||'',
      ramshoLonga: row[3]||'',
      safroCurta : row[4]||'',
      safroLonga : row[5]||'',
      salmos     : row[6]||''
    };
  }
  return by;
}

// === Habilita/Desabilita botões ===
function setLink(a,url){
  if(url){
    a.href=url; a.style.opacity=''; a.style.pointerEvents=''; a.removeAttribute('title');
  }else{
    a.href='#'; a.style.opacity=.55; a.style.pointerEvents='none'; a.title='Link não configurado';
  }
}

// === Load + bind ===
(async ()=>{
  try{
    const res = await fetch(CSV_URL);
    const txt = await res.text();
    const rows = csvToRows(txt);
    const data = mapBySlug(rows);

    const main = data[SLUG_MAIN] || {};
    const salmosPrimary = (data[SLUG_SALMOS]?.salmos) || '';
    const salmosFallback = main.salmos || '';

    const links = {
      'ramsho-curta'    : main.ramshoCurta || '',
      'ramsho-longa'    : main.ramshoLonga || '',
      'safro-curta'     : main.safroCurta  || '',
      'safro-longa'     : main.safroLonga  || '',
      'salmos-leituras' : salmosPrimary || salmosFallback || ''
    };

    document.querySelectorAll('[data-key]').forEach(a=>{
      const k=a.getAttribute('data-key'); setLink(a, links[k]);
    });
  }catch(e){
    console.error('CSV load error', e);
    // Em caso de erro de rede, mantém botões desativados
    document.querySelectorAll('[data-key]').forEach(a=>setLink(a,''));
  }
})();
</script>
</body>
</html>
